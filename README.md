# Stopkran

Telegram-–±–æ—Ç –¥–ª—è —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π Claude Code.

–ö–æ–≥–¥–∞ Claude Code —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–Ω–æ–º–Ω–æ (–Ω–æ—á—å—é, –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω–æ–π –º–∞—à–∏–Ω–µ), –æ–Ω –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–∞—Å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π —á–µ—Ä–µ–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª. Stopkran –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç —ç—Ç–∏ –∑–∞–ø—Ä–æ—Å—ã –≤ Telegram –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ.

```
Claude Code ‚Üí hook ‚Üí Unix socket ‚Üí daemon ‚Üí Telegram ‚Üí —Ç–µ–ª–µ—Ñ–æ–Ω / —á–∞—Å—ã
                                           ‚Üê callback ‚Üê
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.11+
- [uv](https://docs.astral.sh/uv/)
- Telegram-–±–æ—Ç (—Å–æ–∑–¥–∞—Ç—å —á–µ—Ä–µ–∑ [@BotFather](https://t.me/BotFather))

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
git clone <repo-url> && cd jean-claude-stopkran

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–æ–∫–µ–Ω, —Ö—É–∫ –∏ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫
make setup

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–º–æ–Ω –≤ —Ñ–æ–Ω–µ (launchd)
make start-bg

# –û—Ç–ø—Ä–∞–≤–∏—Ç—å /start –±–æ—Ç—É –≤ Telegram
```

–ì–æ—Ç–æ–≤–æ. Claude Code —Ç–µ–ø–µ—Ä—å –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –≤ Telegram.

## Make-–∫–æ–º–∞–Ω–¥—ã

```
make help            –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã
make install         –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (uv sync)
make setup           –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –º–∞—Å—Ç–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
make start           –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–º–æ–Ω (foreground)
make start-bg        –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–º–æ–Ω —á–µ—Ä–µ–∑ launchd
make stop            –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–µ–º–æ–Ω
make restart         –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–º–æ–Ω (launchd)
make status          –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å: –ø—Ä–æ—Ü–µ—Å—Å, —Å–æ–∫–µ—Ç, –∫–æ–Ω—Ñ–∏–≥, —Ö—É–∫
make logs            –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ (tail -f)
make hook-install    –î–æ–±–∞–≤–∏—Ç—å —Ö—É–∫ –≤ ~/.claude/settings.json
make hook-uninstall  –£–±—Ä–∞—Ç—å —Ö—É–∫ –∏–∑ settings.json
make uninstall       –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ: –¥–µ–º–æ–Ω, —Ö—É–∫, –∫–æ–Ω—Ñ–∏–≥
```

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. Claude Code –≤—ã–∑—ã–≤–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ, —Ç—Ä–µ–±—É—é—â–µ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
2. –•—É–∫ `stopkran_hook.py` –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ stdin
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ –¥–µ–º–æ–Ω—É —á–µ—Ä–µ–∑ Unix socket (`/tmp/stopkran.sock`)
4. –î–µ–º–æ–Ω —à–ª—ë—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram —Å –∫–Ω–æ–ø–∫–∞–º–∏ **Allow** / **Deny**
5. –í—ã –Ω–∞–∂–∏–º–∞–µ—Ç–µ –∫–Ω–æ–ø–∫—É ‚Äî —Ä–µ—à–µ–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Å–æ–∫–µ—Ç –≤ Claude Code
6. –ï—Å–ª–∏ –Ω–µ –æ—Ç–≤–µ—Ç–∏—Ç—å –∑–∞ 300 —Å–µ–∫—É–Ω–¥ ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π deny

### Apple Watch –∏ –±—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã

–ö–Ω–æ–ø–∫–∏ Telegram –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ Apple Watch. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –º–æ–∂–Ω–æ –æ—Ç–≤–µ—Ç–∏—Ç—å —Ç–µ–∫—Å—Ç–æ–º:

| –û—Ç–≤–µ—Ç | –î–µ–π—Å—Ç–≤–∏–µ |
|-------|----------|
| –î–∞, yes, –æ–∫, ok, üëç, ‚úÖ | Allow |
| –ù–µ—Ç, no, üëé, ‚ùå | Deny |

–¢–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ —Å–∞–º–æ–º—É —Å—Ç–∞—Ä–æ–º—É –æ–∂–∏–¥–∞—é—â–µ–º—É –∑–∞–ø—Ä–æ—Å—É.

### Graceful degradation

–ï—Å–ª–∏ –¥–µ–º–æ–Ω –Ω–µ –∑–∞–ø—É—â–µ–Ω, —Ö—É–∫ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –º–æ–ª—á–∞ ‚Äî Claude Code –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–±—ã—á–Ω—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–π UI.

## –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/start` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Äî –ø–µ—Ä–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–º |
| `/status` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–∂–∏–¥–∞—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ |

## –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

–ï—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `make setup`:

### –ö–æ–Ω—Ñ–∏–≥

```bash
mkdir -p ~/.config/stopkran
cat > ~/.config/stopkran/config.json << 'EOF'
{
    "token": "YOUR_BOT_TOKEN",
    "chat_id": null,
    "timeout": 300
}
EOF
chmod 600 ~/.config/stopkran/config.json
```

`chat_id` –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ `/start` –≤ Telegram.

### –•—É–∫

```bash
make hook-install
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –≤ `~/.claude/settings.json`:

```json
{
  "hooks": {
    "PermissionRequest": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "python3 /path/to/stopkran_hook.py",
            "timeout": 330000
          }
        ]
      }
    ]
  }
}
```

> –¢–∞–π–º–∞—É—Ç —Ö—É–∫–∞ (330—Å) –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–æ–ª—å—à–µ —Ç–∞–π–º–∞—É—Ç–∞ –¥–µ–º–æ–Ω–∞ (300—Å), —á—Ç–æ–±—ã Claude Code –Ω–µ —É–±–∏–ª —Ö—É–∫ —Ä–∞–Ω—å—à–µ auto-deny.

## –§–∞–π–ª—ã

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `stopkran_daemon.py` | –î–µ–º–æ–Ω: Telegram-–±–æ—Ç + Unix socket —Å–µ—Ä–≤–µ—Ä |
| `stopkran_hook.py` | –•—É–∫ –¥–ª—è Claude Code (—Ç–æ–ª—å–∫–æ stdlib) |
| `stopkran_setup.py` | –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ |
| `com.stopkran.daemon.plist` | –®–∞–±–ª–æ–Ω launchd –¥–ª—è macOS |
| `Makefile` | –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è |
| `pyproject.toml` | –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (uv) |

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

**–î–µ–º–æ–Ω –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è**
```bash
make status    # –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
make logs      # –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
```

**–•—É–∫ –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç**
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Claude Code –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è `settings.json`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `make status` ‚Äî —Ö—É–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

**–ö–Ω–æ–ø–∫–∏ –≤ Telegram –Ω–µ —Ä–µ–∞–≥–∏—Ä—É—é—Ç**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–∞–ø—É—â–µ–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∏–Ω—Å—Ç–∞–Ω—Å –¥–µ–º–æ–Ω–∞ (`make status`)
- –ü—Ä–∏ `409 Conflict` –≤ –ª–æ–≥–∞—Ö ‚Äî `make restart`

**Apple Watch –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**
- –û—Ç–≤–µ—á–∞—Ç—å –Ω—É–∂–Ω–æ –ø—Ä–æ—Å—Ç—ã–º —Ç–µ–∫—Å—Ç–æ–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º, –Ω–µ reply
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –¥–µ–º–æ–Ω –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞
